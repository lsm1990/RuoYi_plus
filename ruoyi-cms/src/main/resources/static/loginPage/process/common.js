var bigPipe={jsVersion:"",cssVersion:"",count:0,jsCounter:0,render:function(a,b){for(var c=document.getElementsByTagName("script"),d=document.getElementsByTagName("link"),e=0;e<c.length;e++){var f=c[e],g=f.getAttribute("src");if(g&&g.indexOf("/assets/js/")>=0){if(g.indexOf("-")<0)break;var h=g.substring(g.indexOf("-"),g.indexOf(".js"));bigPipe.jsVersion=h;break}}for(var e=0;e<d.length;e++){var i=d[e],g=i.getAttribute("href");if(g&&g.indexOf("/assets/css/")>=0){if(g.indexOf("-")<0)break;var h=g.substring(g.indexOf("-"),g.indexOf(".css"));bigPipe.cssVersion=h;break}}var j=a.css||[],k=a.js||[];this.jsCounter=k.length;for(var e=0;e<j.length;e++){var l=j[e];this.renderCss(l)}for(var e=0,m=k.length;e<m;e++){var n=k[e];this.renderJs(n,b)}},renderCss:function(a){var b=document,c=this.cssVersion,d=b.createElement("link");d.setAttribute("rel","stylesheet"),d.setAttribute("type","text/css"),a.indexOf("http")>=0&&(c=""),a=a.replace(".css",c+".css"),d.setAttribute("href",a);var e=b.getElementsByTagName("head");e.length?e[0].appendChild(d):b.documentElement.appendChild(d)},renderJs:function(a,b){var c=document,d=this.jsVersion,e=c.createElement("script");a.indexOf("http")>=0&&(d=""),e.setAttribute("type","text/javascript"),a=a.replace(".js",d+".js"),e.setAttribute("src",a),e.setAttribute("charset","UTF-8"),c.body.appendChild(e),e.onload=function(){bigPipe.count++,bigPipe.handle(b)}},handle:function(a){this.count==this.jsCounter&&(null!=a&&a(),this.count=0,this.jsCounter=0)}},userCommon={showMenu:function(){var a=$(".user-menu");return a.length?void a.popMenu({target:".user-logo",position:"right",onClose:function(){$(".user-logo").removeClass("active")}}):(a=$("<ul style='width:140px;' class='user-menu menu noarrow'><li><a href='/diagrams'><span class='icons'>&#xe632;</span> 我的文件</a></li><li class='sep'></li><li><a href='/setting'><span class='icons'>&#xe63e;</span> 账户中心</a></li><li><a href='/u/profile'><span class='icons'>&#xe63e;</span> 个人主页</a></li><li><a href='/setting#personal' tit='profile'><span class='icons'>&#xe697;</span> 偏好设置</a></li><li><a href='/support' tit='help'><span class='icons'>&#xe66f;</span> 入门教程</a></li><li class='updatelog-btn'><a ><span class='icons'>&#xe6a4;</span> 更新日志</a></li><li class='sep'></li><li><a tit='loginout' href='/login/out'><span class='icons'>&#xe624;</span> 退出登录</a></li></ul>"),a.appendTo("body"),void a.popMenu({target:".user-logo",position:"right",onClose:function(){$(".user-logo").removeClass("active")}}))},updatelog:{loaded:!1,init:function(){var a=this;if("undefined"==typeof updateLog){if(!this.loaded){var b={js:["/assets/js/updatelog.js"],css:["/assets/css/updatelog.css"]};bigPipe.render(b,function(){updateLog.init(),a.loaded=!0})}}else updateLog.init()}},teams:{loaded:!1,init:function(){var a=this;if("undefined"==typeof team){if(!this.loaded){var b={js:["/assets/js/team.js"],css:["/assets/css/team.css"]};bigPipe.render(b,function(){team.renderCon(),a.loaded=!0})}}else team.renderCon()}},notice:{loaded:!1,init:function(a){var b=this;if("undefined"==typeof notification){if(!this.loaded){var c={js:["/assets/js/notification/notification.js"],css:["/assets/css/notification.css"]};bigPipe.render(c,function(){notification.renderCon(a),b.loaded=!0})}}else notification.renderCon(a)}}};!function(){$("body").off("click.updatelog").on("click.updatelog",".updatelog-btn",function(){$(".user-menu").popMenu("close"),userCommon.updatelog.init()}),$(".user-logo").on("click",function(a){$(this).addClass(" active"),userCommon.showMenu()}),$(".notice-icon").off().on("click",function(a){a.stopPropagation();var b=$(this);userCommon.notice.init(b)}),$("#menu_team").off().on("click",function(a){a.stopPropagation();var b=userCommon.teams;b.init()});var a=$(".notice-icon");if(a.length>0){var b=a.find(".icon-warp .badge");$.get("/notification/count",{},function(a){a.count>0?b.length>0?b.text(a.count):$("<span class='badge warning global-tip'>"+a.count+"</span>").appendTo(".notice-icon .icon-warp"):$(".notice-icon .icon-warp .badge").remove()})}}();